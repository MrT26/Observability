                       Observability Stack User Guide

Application: Node.js + MongoDB
Monitoring Stack: Prometheus + Grafana + Loki + Promtail + cAdvisor + MongoDB Exporter

üèóÔ∏è 1. Architecture Overview
| Component        | Purpose                            |
| ---------------- | ---------------------------------- |
| Node.js Backend  | Application logic + custom metrics |
| MongoDB          | Database                           |
| Prometheus       | Metrics collection                 |
| Grafana          | Visualization dashboards           |
| Loki             | Log aggregation                    |
| Promtail         | Log shipper                        |
| cAdvisor         | Container metrics                  |
| MongoDB Exporter | Mongo metrics                      |


üîÑ Observability Flow

Application ‚Üí /metrics ‚Üí Prometheus ‚Üí Grafana
Docker Logs ‚Üí Promtail ‚Üí Loki ‚Üí Grafana
Containers ‚Üí cAdvisor ‚Üí Prometheus ‚Üí Grafana
MongoDB ‚Üí Mongo Exporter ‚Üí Prometheus ‚Üí Grafana

‚öôÔ∏è 2. Setup Instructions
Step 1Ô∏è‚É£ ‚Äì Start the Stack
docker-compose up -d
docker ps

Step 2Ô∏è‚É£ ‚Äì Access Services|
| Service         | URL                                                            |
| --------------- | -------------------------------------------------------------- |
| Frontend        | [http://localhost](http://localhost)                           |
| Backend API     | [http://localhost:3000](http://localhost:3000)                 |
| Backend Metrics | [http://localhost:3000/metrics](http://localhost:3000/metrics) |
| Prometheus      | [http://localhost:9090](http://localhost:9090)                 |
| Grafana         | [http://localhost:3001](http://localhost:3001)                 |
| cAdvisor        | [http://localhost:8080](http://localhost:8080)                 |
| Loki            | [http://localhost:3100](http://localhost:3100)                 |


Step 3Ô∏è‚É£ ‚Äì Configure Grafana

Login to Grafana
Default credentials:

Username: admin
Password: admin

Add Data Sources:
Prometheus ‚Üí http://prometheus:9090
Loki ‚Üí http://loki:3100

Import or create dashboards.

üìä 3. What You Can Monitor
A. Application Metrics (Node.js)
Collected using prom-client.

1Ô∏è‚É£ HTTP Traffic

   Metric:
    http_requests_total

   You can monitor:
    Total request count
    Requests per second
    Traffic spikes
    Per-route traffic

2Ô∏è‚É£ Error Rate

  Query:
    sum(rate(http_requests_total{status=~"5.."}[5m]))/sum(rate(http_requests_total[5m]))

  You can monitor:
   4xx errors
   5xx errors
   API stability
   Failure trends

3Ô∏è‚É£ Latency (p90 / p95 / p99)

  Metric:
    http_request_duration_seconds

  Example query (p95):
     histogram_quantile(0.95,sum(rate(http_request_duration_seconds_bucket[5m])) by (le))

  You can monitor:
     p90 latency
     p95 latency
     p99 latency
     Slow endpoints
     Performance degradation

4Ô∏è‚É£ Node.js Runtime Metrics

  Automatically collected:
    CPU usage
    Memory usage
    Heap size
    Event loop lag
    GC activity
  Useful for:
    Memory leaks
    High CPU usage
    vent loop blocking

B.Container Metrics (cAdvisor)

  You can monitor:  
     Container CPU %
     Container memory usage
     Network I/O
     File system usage
     Restart count

  Example queries:
   CPU usage:
     rate(container_cpu_usage_seconds_total[5m])

   Memory usage:
     container_memory_usage_bytes

C.MongoDB Metrics (MongoDB Exporter)

  You can monitor:
    Active connections
    uery rate
    Insert/update/delete rate
    Opcounters
    Replication stats
    Cache usage
    Lock percentage

  Example:
    Connections:
      mongodb_connections

    Operations:
      mongodb_op_counters_total

D.Logs (Loki + Promtail)

  Collected from Docker containers.
    You can:
      View application logs
      Filter by container
      Search errors
      Track exceptions
      Correlate logs with metrics

  Example LogQL query:
    {container="backend"} |= "error"

E. Prometheus Self-Monitoring

  You can monitor:
    Prometheus scrape duration
    Failed scrapes
    Target health
    Time series count

  Metric:
  up

4. Production-Level Observability Coverage

| Layer               | Covered                        |
| ------------------- | ------------------------------ |
| Application metrics | ‚úÖ                              |
| API performance     | ‚úÖ                              |
| Error tracking      | ‚úÖ                              |
| Runtime health      | ‚úÖ                              |
| Container health    | ‚úÖ                              |
| Database health     | ‚úÖ                              |
| Logs                | ‚úÖ                              |
| Infrastructure      | Partial                        |
| Distributed tracing | ‚ùå (unless OpenTelemetry added) |


7.Troubleshooting Guide

   If metrics not visible:

   Check Prometheus targets:
     http://localhost:9090/targets

   Check /metrics endpoint manually.

   Verify service names inside Docker network.

   If logs missing:
    Verify promtail config
    Check Loki connection

   If dashboards disappear:
     Verify Grafana volume persistence

9. Possible Future Enhancements
    OpenTelemetry (distributed tracing)= 
    lertmanager with Slack/email alerts
    Kubernetes migration
    Node Exporter for host metrics
    Tempo for tracing



